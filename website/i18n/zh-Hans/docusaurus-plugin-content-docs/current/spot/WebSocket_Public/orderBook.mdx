---
id: 订单bookManage
title: 订单簿管理
sidebar_label: 订单簿管理
sidebar_position: 7
---

### 如何正确管理本地订单簿

1. 打开到 `wss://stream.xt.com/public` 的流，例如 `depth_update@btc_usdt`。
2. 缓冲从流中接收的事件。
3. 从 `https://sapi.xt.com/v4/public/depth?symbol=btc_usdt&limit=500` 获取深度快照。
4. 丢弃快照中 `i <= lastUpdateId` 的任何事件。
5. 第一个处理的事件应该有 `fi <= lastUpdateId + 1` **并且** `i >= lastUpdateId + 1`。
6. 在监听流时，每个新事件的 `fi` 应该等于前一个事件的 `i + 1`。
7. 每个事件中的数据是价格级别的绝对数量。
8. 如果数量为0，则删除价格级别。
9. 接收删除本地订单簿中不存在的价格级别的事件是正常的。

**注意:** 由于深度快照对价格级别数量有限制，初始快照之外没有数量变化的价格级别在差异深度流中不会有更新。因此，即使正确应用差异深度流的所有更新，这些价格级别在本地订单簿中也不可见。这可能导致本地订单簿与真实订单簿存在一些细微差异。但是，对于大多数用例，500的深度限制足以理解市场并有效交易。
